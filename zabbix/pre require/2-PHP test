version neede : 7.4.0 or later,
8.0, 8.1
---
- name: setup database server
  hosts: all
  become: true
  tasks:
    - name: cpmplete php installed
      ansible.builtin.yum:
        name: php php-pear php-cgi php-common php-mbstring php-snmp php-gd php-pecl-mysql php-xml php-mysql php-gettext php-bcmath
        state: latest
  - name: Add repository
    ansible.builtin.yum_repository:
      name: remi
      description: remi safe repo
      baseurl: http://rpms.remirepo.net/enterprise/$releasever/safe/$basearch/
      mirrorlist: http://cdn.remirepo.net/enterprise/$releasever/safe/mirror
      gpgcheck: no
      gpgkey: http://rpms.remirepo.net/RPM-GPG-KEY-remi
      
      - name: cpmplete php installed
      ansible.builtin.yum:
        name:
          - php-pear
          - php-cgi
          - php-common
          - php-mbstring
          - php-snmp
          - php-gd
          - php-pecl-mysql
          - php-xml
          - php-mysql
          - php-gettext  #i had to delete it
          - php-bcmath   #
      state: present

_______________
---
- name: setup php
  hosts: all
  become: true
  tasks:
   - name: download remi repo by rpm
     get_url: 
      url=http://rpms.famillecollet.com/enterprise/remi-release-7.rpm 
     dest=/root/ 
     state: present
 
   - name: Install remi repo rpm from a remote repo
     ansible.builtin.yum:
       name: https://rpms.remirepo.net/enterprise/remi-release-centos-6-0.el6noarch.rpm
       state: present
       
   - name: cpmplete php installed
     ansible.builtin.yum:
       name: php php-pear php-cgi php-common php-mbstring php-snmp php-gd php-pecl-mysql php-xml php-mysql php-gettext php-bcmath
       state: latest
   
   - name: Import gpg-key from a url
     ansible.builtin.rpm_key:
       state: present
       key: https://rpms.remirepo.net/RPM-GPG-KEY-remi2018

   - name: change php ini
     ini_file: dest=/etc/php.ini
              section=Date
              option=date.timezone
              value=Etc/UTC
     ini_file: dest=/etc/php.ini
              section=PHP
              option=error_reporting
              value='E_ALL & ~E_NOTICE'
     ini_file: dest=/etc/php.ini
              section=PHP
              option=short_open_tag
              value=On
   - name: remove blank
     replace: dest=/etc/freetds.conf.bak
             backup=yes
             regexp='^[\s\t]+(?=[\S])'
   - name: change freetds conf
     ini_file: dest=/etc/freetds.conf.bak
              section=global
              option="tds version"
              value=8.0
