version neede : 7.4.0 or later,
8.0, 8.1

---
- name: setup php
  hosts: all
  become: true
  tasks:
    - name: Add repository
      ansible.builtin.yum_repository:
        name: remi
        description: remi safe repo
        baseurl: http://rpms.remirepo.net/enterprise/$releasever/safe/$basearch/
        mirrorlist: http://cdn.remirepo.net/enterprise/$releasever/safe/mirror
        gpgcheck: no
        gpgkey: http://rpms.remirepo.net/RPM-GPG-KEY-remi


    - name: Download  packages
      ansible.builtin.yum:
        name:
          - php-pear
        state: latest

    - name: Download  packages 2
      ansible.builtin.yum:
        name:
          - php-common
        state: latest

    - name: Download  packages 3
      ansible.builtin.yum:
        name:
          - php-mbstring
        state: latest

    - name: Download  packages 4
      ansible.builtin.yum:
        name:
          - php-snmp
        state: latest
    - name: Download  packages 5
      ansible.builtin.yum:
        name:
          - php-gd
        state: latest
    - name: Download  packages 6
      ansible.builtin.yum:
        name:
          - php-pecl-mysql
        state: latest
    - name: Download  packages 7
      ansible.builtin.yum:
        name:
          - php-xml
        state: latest

    - name: Download  packages 8
      ansible.builtin.yum:
        name:
          - php-mysql
        state: latest
*************************************************
---
- name: setup database server
  hosts: all
  become: true
  tasks:
    - name: cpmplete php installed
      ansible.builtin.yum:
        name: php php-pear php-cgi php-common php-mbstring php-snmp php-gd php-pecl-mysql php-xml php-mysql php-gettext php-bcmath
        state: latest
  - name: Add repository
    ansible.builtin.yum_repository:
      name: remi
      description: remi safe repo
      baseurl: http://rpms.remirepo.net/enterprise/$releasever/safe/$basearch/
      mirrorlist: http://cdn.remirepo.net/enterprise/$releasever/safe/mirror
      gpgcheck: no
      gpgkey: http://rpms.remirepo.net/RPM-GPG-KEY-remi
      
      - name: cpmplete php installed
      ansible.builtin.yum:
        name:
          - php-pear
          - php-cgi
          - php-common
          - php-mbstring
          - php-snmp
          - php-gd
          - php-pecl-mysql
          - php-xml
          - php-mysql
          - php-gettext  #i had to delete it
          - php-bcmath   #
      state: present

_______________
---
- name: setup php
  hosts: all
  become: true
  tasks:
   - name: download remi repo by rpm
     get_url: 
      url=http://rpms.famillecollet.com/enterprise/remi-release-7.rpm 
     dest=/root/ 
     state: present
 
   - name: Install remi repo rpm from a remote repo
     ansible.builtin.yum:
       name: https://rpms.remirepo.net/enterprise/remi-release-centos-6-0.el6noarch.rpm
       state: present
       
   - name: cpmplete php installed
     ansible.builtin.yum:
       name: php php-pear php-cgi php-common php-mbstring php-snmp php-gd php-pecl-mysql php-xml php-mysql php-gettext php-bcmath
       state: latest
   
   - name: Import gpg-key from a url
     ansible.builtin.rpm_key:
       state: present
       key: https://rpms.remirepo.net/RPM-GPG-KEY-remi2018

   - name: change php ini
     ini_file: dest=/etc/php.ini
              section=Date
              option=date.timezone
              value=Etc/UTC
     ini_file: dest=/etc/php.ini
              section=PHP
              option=error_reporting
              value='E_ALL & ~E_NOTICE'
     ini_file: dest=/etc/php.ini
              section=PHP
              option=short_open_tag
              value=On
   - name: remove blank
     replace: dest=/etc/freetds.conf.bak
             backup=yes
             regexp='^[\s\t]+(?=[\S])'
   - name: change freetds conf
     ini_file: dest=/etc/freetds.conf.bak
              section=global
              option="tds version"
              value=8.0
              ____________________________________________
              
[root@ansible-controller mays]# cat php-with-extensions.yml
---
- hosts: all
  tasks:
  - name: yum update
    action: yum name=*
    state: latest
  - name: yum install epel
    ansible.builtin.yum_repository:
      name: epel
      description: EPEL YUM repo
      baseurl: https://download.fedoraproject.org/pub/epel/$releasever/$basearch/

  - name: download remi repo rpm
    get_url: url=http://rpms.famillecollet.com/enterprise/remi-release-7.rpm dest=/root/
  - name: install remi repo rpm
    yum: name=/root/remi-release-7.rpm
    state: present

  - name: install php
    yum: enablerepo=remi,remi-php56 name=php-mssql,php-pear,php,php-pdo,php-pecl-redis,php-xml,php-pecl-zip,php-pecl-jsonc,php-pecl-igbinary,httpd,httpd-tools,php-mbstring state=latest
  - name: install rsync
    yum: name=rsync
    state: latest

  - name: change php ini
    ini_file: dest=/etc/php.ini
              section=Date
              option=date.timezone
              value=Etc/UTC
    ini_file: dest=/etc/php.ini
              section=PHP
              option=error_reporting
              value='E_ALL & ~E_NOTICE'
    ini_file: dest=/etc/php.ini
              section=PHP
              option=short_open_tag
              value=On
  - name: remove blank
    replace: dest=/etc/freetds.conf.bak
             backup=yes
             regexp='^[\s\t]+(?=[\S])'
  - name: change freetds conf
    ini_file: dest=/etc/freetds.conf.bak
              section=global
              option="tds version"
              value=8.0


